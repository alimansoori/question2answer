CKEDITOR.dialog.add("codeplayerDialog",function(b){function k(a){$.ajax({url:b.settings.url+"/"+a.getAttribute("data-ajax"),async:!1,type:"GET",dataType:"json",timeout:5E3,success:function(a,b){console.log(a);console.log("status code \x3d\x3e "+b);e=JSON.stringify(a.data.content)},fail:function(b,c,d){console.log("error ajax");404===c&&(a=f(a,"{}"))}});return a}function f(a,c){$.ajax({url:b.settings.url,async:!1,type:"POST",dataType:"json",timeout:5E3,data:{content:c},success:function(b,c){console.log("success create codeplayer in server");
e=JSON.stringify(b.content);a.setAttribute("data-ajax",b.id)},fail:function(a,b,c){console.log("fail create codeplayer")}});return a}function l(a,c){$.ajax({url:b.settings.url+"/"+a.getAttribute("data-ajax"),async:!1,type:"PUT",dataType:"json",timeout:5E3,data:{content:c},success:function(b,c){console.log("success update codeplayer in server");e=JSON.stringify(b.content);a.setAttribute("data-ajax",b.id)},fail:function(a,b,c){console.log("fail update codeplayer")}});return a}var g,e="",c,d,h;return{title:b.lang.codeplayer.title,
width:800,contents:[{id:"editor",label:b.lang.codeplayer.editor,elements:[{type:"hbox",children:[{type:"select",id:"code-select",className:"cke_codeplayer_form",label:b.lang.codeplayer.mode,items:b.settings.modes,"default":b.settings.modes[0][1],setup:function(a){a&&this.setValue(a.getAttribute("data-lang"))},commit:function(a){a&&a.setAttribute("data-lang",this.getValue())},onChange:function(){d.setMode("ace/mode/"+this.getValue())}},{type:"select",id:"code-tabsize-select",className:"cke_codeplayer_form",
label:b.lang.codeplayer.tabSize,items:["1","2","4","8"],"default":b.settings.tab_size,setup:function(a){a&&this.setValue(a.getAttribute("data-tabsize"))},commit:function(a){a&&a.setAttribute("data-tabsize",this.getValue())},onChange:function(a){a&&(h.convertIndentation(d," ",this.getValue()),d.setTabSize(this.getValue()))}}]},{type:"html",html:"\x3cdiv\x3e\x3c/div\x3e",id:"code-textarea",className:"cke_codeplayer_ace",style:"position: absolute; top: 140px; left: 10px; right: 10px; bottom: 50px;",
setup:function(a){a=JSON.parse(e);a=a.replace(RegExp("\x3cbr/\x3e","g"),"\n").replace(RegExp("\x3cbr\x3e","g"),"\n").replace(RegExp("\x26lt;","g"),"\x3c").replace(RegExp("\x26gt;","g"),"\x3e").replace(RegExp("\x26amp;","g"),"\x26").replace(RegExp("\x26nbsp;","g")," ");c.setValue(a)},commit:function(a){}}]},{id:"preview",label:"Preview",title:"First Tab Title",elements:[{type:"html",html:"\x3cdiv\x3e\x3c/div\x3e",id:"codeplayer",style:"max-width:800px;"}]}],onLoad:function(){g=this;c=ace.edit(g.getContentElement("editor",
"code-textarea").getElement().getId());b.aceEditor=c;c.setTheme("ace/theme/"+b.settings.theme);c.setHighlightActiveLine(!0);c.setShowInvisibles(!0);d=c.getSession();d.setMode("ace/mode/"+b.settings.modes[0][1]);d.setTabSize(b.settings.tab_size);d.setUseSoftTabs(!0);d.on("change",function(){e=d.getValue();console.log(e)});h=ace.require("ace/ext/whitespace");ace.require("ace/ext/beautify")},onShow:function(){var a=b.getSelection().getStartElement();a&&(a=a.getAscendant("div",!0))&&!a.hasAttribute("data-ajax")&&
(a=new CKEDITOR.dom.element("div"));this.insertMode=!0;a&&"div"===a.getName()?a.hasAttribute("data-ajax")?this.insertMode=!1:console.log(a.getAttribute("data-ajax")):a=new CKEDITOR.dom.element("div");this.insertMode?console.log("insert mode"):console.log("edit mode");console.log(a);this.element=a;c.focus();c.setValue("");this.insertMode||(this.element=k(this.element),this.setupContent(this.element))},onOk:function(){var a;a=this.element;this.commitContent(a);a=this.insertMode?f(a,e):l(a,e);a.addClass("cp-projekt");
this.insertMode&&b.insertElement(a)}}});CKEDITOR.dialog.on("resize",function(b){b=b.editor.aceEditor;void 0!==b&&b.resize()});